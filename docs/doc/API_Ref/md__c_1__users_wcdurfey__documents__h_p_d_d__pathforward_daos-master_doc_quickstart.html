<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DAOS API Reference: DAOS Quick Start Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Intel_Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DAOS API Reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">DAOS Quick Start Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>DAOS runs on both x86 and ARM platforms and has been successfully tested on CentOS7, openSuSE 42.2 and Ubuntu 16.04 distributions.</p>
<h2>Hardware Support</h2>
<p>DAOS requires a 64-bit processor architecture and is primarily developed on x64-64 and AArch64 platforms. Apart from using a popular linux distribution, no special considerations are necessary to build DAOS on 64-bit ARM processors. The same instructions that are used in Xeon are applicable for ARM builds as well, DAOS and its dependencies will make the necessary adjustments automatically in their respective build systems for ARM platforms.</p>
<p>Storage-class memory (SCM) can be emulated with DRAM by creating tmpfs mountpoints on the DAOS servers.</p>
<h2>Software Dependencies</h2>
<p>DAOS requires a C99-capable compiler, a golang compiler and the scons build tool. Moreover, the DAOS stack leverages the following open source projects:</p><ul>
<li><a href="https://github.com/daos-stack/cart">CaRT</a> that relies on both <a href="https://mercury-hpc.github.io">Mercury</a> and <a href="https://ofiwg.github.io/libfabric/">Libfabric</a> for lightweight network transport and <a href="https://github.com/pmix/master">PMIx</a> for process set management. See the CaRT repository for more information on how to build the CaRT library.</li>
<li><a href="https://github.com/pmem/pmdk.git">PMDK</a> for persistent memory programming.</li>
<li><a href="http://spdk.io">SPDK</a> for userspace NVMe device access and management.</li>
<li><a href="https://github.com/01org/isa-l">ISA-L</a> for checksum and erasure code computation.</li>
<li><a href="https://github.com/pmodels/argobots">Argobots</a> for thread management.</li>
</ul>
<p>The DAOS build system can be configured to download and build any missing dependencies automatically.</p>
<h2>DAOS Source Code</h2>
<p>To check out the DAOS source code, run the following command: </p><pre class="fragment">$ git clone https://github.com/daos-stack/daos.git
</pre><p>This clones the DAOS git repository (path referred as ${daospath} below). Then initialize the submodules with: </p><pre class="fragment">$ cd ${daospath}
$ git submodule init
$ git submodule update
</pre><h2>DAOS in Docker</h2>
<p>Docker is the fastest way to build, install and run DAOS on a non-Linux system.</p>
<h3>Building DAOS in a Container</h3>
<p>To build the Docker image directly from GitHub, run the following command: </p><pre class="fragment">$ docker build -t daos -f Dockerfile.centos\:7 github.com/daos-stack/daos#:utils/docker
</pre><p>This creates a CentOS7 image, fetches the latest DAOS version from GitHub and builds it in the container. For Ubuntu, replace Dockerfile.centos\:7 with Dockerfile.ubuntu\:16.04.</p>
<p>To build from a local tree stored on the host, a volume must be created to share the source tree with the Docker container. To do so, execute the following command to create a docker image without checking out the DAOS source tree: </p><pre class="fragment">$ docker build -t daos -f utils/docker/Dockerfile.centos\:7 --build-arg NOBUILD=1 .
</pre><p>And then the following command to export the DAOS source tree to the docker container and build it: </p><pre class="fragment">$ docker run -v ${daospath}:/home/daos/daos:Z daos scons --build-deps=yes USE_INSTALLED=all install
</pre><h3>Running DAOS in a Container</h3>
<p>Let's first create a container that will run the DAOS service: </p><pre class="fragment">$ docker run -it -d --name server --tmpfs /mnt/daos:rw,uid=1000,size=1G -v /tmp/uri:/tmp/uri daos
</pre><p>Add "-v \${daospath}:/home/daos/daos:Z" to this command line if DAOS source tree is stored on the host.</p>
<p>This allocates 1GB of DRAM for DAOS storage. The more, the better.</p>
<p>To start the DAOS service in this newly created container, execute the following command: </p><pre class="fragment">$ docker exec server orterun -H localhost -np 1 --report-uri /tmp/uri/uri.txt daos_server
</pre><p>Once the DAOS server is started, the integration tests can be run as follows: </p><pre class="fragment">$ docker run -v /tmp/uri:/tmp/uri daos \
  orterun -H localhost -np 1 --ompi-server file:/tmp/uri/uri.txt daos_test
</pre><p>Again, "-v \${daospath}:/home/daos/daos:Z" must be added if the DAOS source tree is shared with the host.</p>
<h2>DAOS from Scratch</h2>
<p>The below instructions have been verified with CentOS. Installations on other Linux distributions might be similar with some variations. Please contact us in our <a href="users@daos.groups.io">forum</a> if running into issues.</p>
<h3>Build Prerequisites</h3>
<p>Please install the following software packages (or equivalent for other distros):</p>
<p>On CentOS and openSuSE: </p><pre class="fragment">$ yum install -y epel-release
$ yum install -y git gcc gcc-c++ make cmake golang libtool scons boost-devel
$ yum install -y libuuid-devel openssl-devel libevent-devel libtool-ltdl-devel
$ yum install -y librdmacm-devel libcmocka libcmocka-devel readline-devel
$ yum install -y doxygen pandoc flex patch nasm yasm
# Additionally required SPDK packages
$ yum install -y CUnit-devel libaio-devel astyle-devel python-pep8 lcov
$ yum install -y python clang-analyzer sg3_utils libiscsi-devel
$ yum install -y libibverbs-devel numactl-devel doxygen mscgen graphviz
</pre><p>On Ubuntu and Debian: </p><pre class="fragment">$ apt-get install -y git gcc golang make cmake libtool-bin scons autoconf
$ apt-get install -y libboost-dev uuid-dev libssl-dev libevent-dev libltdl-dev
$ apt-get install -y librdmacm-dev libcmocka0 libcmocka-dev libreadline6-dev
$ apt-get install -y curl doxygen pandoc flex patch nasm yasm
# Additionally required SPDK packages
$ apt-get install -y libibverbs-dev librdmacm-dev libcunit1-dev graphviz
$ apt-get install -y libaio-dev sg3-utils libiscsi-dev doxygen mscgen
</pre><p>Moreover, please make sure all the auto tools listed below are at the appropriate versions. </p><pre class="fragment">m4 (GNU M4) 1.4.16
flex 2.5.37
autoconf (GNU Autoconf) 2.69
automake (GNU automake) 1.13.4
libtool (GNU libtool) 2.4.2
</pre><h3>Building DAOS &amp; Dependencies</h3>
<p>If all the software dependencies listed previously are already satisfied, then just type the following command in the top source directory to build the DAOS stack: </p><pre class="fragment">$ scons install
</pre><p>Otherwise, the missing dependencies can be built automatically by invoking scons with the following parameters: </p><pre class="fragment">$ scons --build-deps=yes USE_INSTALLED=all install
</pre><p>By default, DAOS and its dependencies are installed under ${daospath}/install. The installation path can be modified by adding the PREFIX= option to the above command line (e.g. PREFIX=/usr/local).</p>
<h3>Environment setup</h3>
<p>Once built, the environment must be modified to search for binaries and header files in the installation path. This step is not required if standard locations (e.g. /bin, /sbin, /usr/lib, ...) are used. </p><pre class="fragment">CPATH=${daospath}/install/include/:$CPATH
PATH=${daospath}/install/bin/:${daospath}/install/sbin:$PATH
export CPATH PATH
</pre><p>If using bash, PATH can be setup for you after a build by sourcing the script scons_local/utils/setup_local.sh from the daos root. This script utilizes a file generated by the build to determine the location of daos and its dependencies.</p>
<p>If required, ${daospath}/install must be replaced with the alternative path specified through PREFIX. The network type to use as well the debug log location can be selected as follows: </p><pre class="fragment">export CRT_PHY_ADDR_STR="ofi+sockets",
OFI_INTERFACE=eth0, where eth0 is the network device you want to use.
for infiniband you could use ib0 or whichever else pointing to IB device.
</pre><h3>Running DAOS</h3>
<p>DAOS uses orterun(1) for scalable process launch. The list of storage nodes can be specified in an host file (referred as ${hostfile}). The DAOS server and the application can be started seperately, but must share an URI file (referred as ${urifile}) to connect to each other. The ${urifile} is generated by orterun using (--report-uri filename) at server and used at application with (--ompi-server <a href="file:filename">file:filename</a>). In addition, the DAOS server must be started with the --enable-recovery option to support server failure. See the orterun(1) man page for additional options.</p>
<p>(a) Starting the DAOS server</p>
<p>On each storage node, the DAOS server will use a storage path (specified by &ndash;storage or -s) that must be a directory in a tmpfs filesystem, for the time being. If not specified, it is assumed to be /mnt/daos. To configure the storage: </p><pre class="fragment">$ mount -t tmpfs -o size=&lt;bytes&gt; tmpfs /mnt/daos
</pre><p>To start the DAOS server, run: </p><pre class="fragment">$ orterun -np &lt;num_servers&gt; --hostfile ${hostfile} --enable-recovery --report-uri ${urifile} daos_server
</pre><p>By default, the DAOS server will use all the cores available on the storage server. You can limit the number of execution streams with the -c #cores_to_use option. Hostfile used here is the same as the ones used by Open MPI. See (<a href="https://www.open-mpi.org/faq/?category=running#mpirun-hostfile">https://www.open-mpi.org/faq/?category=running#mpirun-hostfile</a>) for additional details.</p>
<p>(b) Creating/destroy a DAOS pool</p>
<p>A DAOS pool can be created and destroyed through the DAOS management API (see <a class="el" href="daos__mgmt_8h.html">daos_mgmt.h</a>). We also provide an utility called dmg to manage storage pools from the command line.</p>
<p>To create a pool: </p><pre class="fragment">$ orterun --ompi-server file:${urifile} dmg create --size=xxG
</pre><p>This creates a pool distributed across the DAOS servers with a target size on each server of xxGB. The UUID allocated to the newly created pool is printed to stdout (referred as ${pooluuid}).</p>
<p>To destroy a pool: </p><pre class="fragment">$ orterun --ompi-server file:${urifile} dmg destroy --pool=${pooluuid}
</pre><p>(c) Building applications or I/O middleware against the DAOS library</p>
<p>Include the <a class="el" href="daos_8h.html">daos.h</a> header file in your program and link with -Ldaos. Examples are available under src/tests.</p>
<p>(d) Running applications </p><pre class="fragment">$ orterun -np &lt;num_clients&gt; --hostfile ${hostfile_cli} --ompi-server file:$urifile ${application} eg., ./daos_test
</pre><h2>DAOS for Development</h2>
<p>For development, it is recommended to build and install each dependency in a unique subdirectory. The DAOS build system supports this through the TARGET_PREFIX variable. Once the submodules have been initialized and updated, run the following: </p><pre class="fragment">$ scons PREFIX=$(daos_prefix_path} TARGET_PREFIX=${daos_prefix_path}/opt install --build-deps=yes
</pre><p>Installing the components into seperate directories allow to upgrade the components individually replacing &ndash;build-deps=yes with &ndash;update-prereq={component_name}. This requires change to the environment configuration from before. For automated environment setup, source scons_local/utils/setup_local.sh. </p><pre class="fragment">ARGOBOTS=${daos_prefix_path}/opt/argobots
CART=${daos_prefix_path}/opt/cart
HWLOC=${daos_prefix_path}/opt/hwloc
MERCURY=${daos_prefix_path}/opt/mercury
PMDK=${daos_prefix_path}/opt/pmdk
OMPI=${daos_prefix_path}/opt/ompi
OPA=${daos_prefix_path}/opt/openpa
PMIX=${daos_prefix_path}/opt/pmix
SPDK=${daos_prefix_path}/opt/spdk

PATH=$CART/bin/:$OMPI/bin/:${daos_prefix_path}/bin/:$PATH
</pre><p>With this approach DAOS would get built using the prebuilt dependencies in ${daos_prefix_path}/opt and required options are saved for future compilations. So, after the first time, during development, a mere "scons" and "scons install" would suffice for compiling changes to daos source code.</p>
<p>If you wish to compile DAOS with clang rather than gcc, set COMPILER=clang on the scons command line. This option is also saved for future compilations. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
